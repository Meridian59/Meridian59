
import os
import boto3
import base64

def util_encrypt_password(password):
    # Initialize the Boto3 client for AWS KMS
    kms_client = boto3.client('kms', region_name=os.environ['region_name'])

    # Retrieve the KMS key ID or alias from environment variables
    key_id_or_alias = os.environ['kms_alias']

    # Encrypt the password using the specified KMS key
    response = kms_client.encrypt(
        KeyId=key_id_or_alias,
        Plaintext=password,
        EncryptionAlgorithm='RSAES_OAEP_SHA_256'
    )

    # Return the ciphertext
    base64_encoded_bytes = base64.b64encode(response['CiphertextBlob'])
    return base64_encoded_bytes.decode('utf-8')

def util_decrypt_password(ciphertext_base64):
    kms_client = boto3.client('kms', region_name=os.environ["region_name"])

    # Retrieve the KMS key ID or alias from environment variables
    key_id_or_alias = os.environ['kms_alias']

    ciphertext = base64.b64decode(ciphertext_base64)

    # Decrypt the ciphertext using AWS KMS
    response = kms_client.decrypt(
        KeyId=key_id_or_alias,
        CiphertextBlob=ciphertext,
        EncryptionAlgorithm='RSAES_OAEP_SHA_256'
    )

    # Return the plaintext password
    plaintext_password = response['Plaintext'].decode('utf-8')
    return plaintext_password