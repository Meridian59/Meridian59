% Meridian 59, Copyright 1994-2012 Andrew Kirmse and Chris Kirmse.
% All rights reserved.
%
% This software is distributed under a license that is described in
% the LICENSE file that accompanies it.
%
% Meridian is a registered trademark.


%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
TosApoth is TosRoom

constants:

   include blakston.khd

resources:

   include tosapoth.lkod

   room_name_tosapoth = "Frisconar's Mysticals"
   room_tosapoth = tosapoth.roo
   tosapoth_music = song02.mp3

   tosapoth_book_name = "The Legacy of Konima"
   tosapoth_book_text = \
      "Chapter 1: Waves of Blood\n"
      "\n"
      "\n"
           "   And so they came.\n"
      "\n"
           "   At first a trickle, and then a flood.  Waves upon waves of them, in an orgy "
      "of never-ending bloodthirst, they conquered with ease, plundering with malice "
      "and burning everything left behind them with subhuman glee.  The Twisted Wood, "
      "once merely a wary place to tread, became a deathtrap overnight as the "
      "encroaching Orc armies crept closer to the walls of Tos, until the evil ilk set "
      "up their moth-ridden tents within kissing distance the gates themselves, in a "
      "shameless mockery of civilized man.\n"
           "   Our men fought with valor, with desperation and with their backs to the "
      "city walls, and the masonry was deeply stained with the blood of orc and man.  "
      "Finally, our generals realized that we had barely enough men left to man the "
      "walls, and the retreat was sounded.  We ran for the city gates like craven dogs.  "
      "I was the last one in.  I watched in horror, as we closed the gates on the "
      "stragglers.  Their fates were sealed, but at least most of them had the "
      "satisfaction of a quick and painless death.  Those of us inside were not so lucky.\n"
      "\n"
      ""
      "Chapter 2: the Siege of Tos\n"
      "\n"
      "   Tos is the oldest of the great cities, formed by settlers weary of the barbarity "
      "that ruled the land before we were blessed with civilization.  Since the enemy of "
      "man was other men, our ancestors chose a place that was defensible to the north, in "
      "hopes that the Badlands to our north would thwart our enemies.  Not twenty years "
      "ago, we proved these defenses were still strong, when we used magic to make the "
      "canyon walls collapse on our Barloqian enemies.  Hundreds died.\n"
      "   Now that we faced a threat from the south, though, this advantage was turned "
      "against us.  The other great cities had heard of our plight, and sent aid, from "
      "Jasper, from Cor Noth, even from our mistrustful brothers of Barloque.  But the "
      "orcs had the city of Tos surrounded, and were quick to move a contingent north, "
      "where they defended the border of the badlands by hurling rocks from the canyon "
      "walls.\n"
      "  Meanwhile, in the city walls, we found ourselves on the losing end of the waiting "
      "game.  Once the orcs had forced our armies into the city walls, they blockaded "
      "the gates, and seemed quite willing to sit outside until the time was proper.  "
      "Inside, we had nothing better to do, but to tend the wounded, weep, pray, and die.  "
      "Mostly, we died.\n"
      ""
      "   Water was the first thing to go.  Tos was not built near a river - it gets its "
      "water from deep wells fed from mountain streams.  The orcs found those streams, "
      "and poisoned them with rotting flesh. We found out when our children died.\n" 
      "   Then the plague came.  Orcs don't believe in burying their dead on the "
      "battlefield when they die, much less ours.  And so the smell, and the disease that "
      "came with it, piled over the city walls.  We realized this was happening when our "
      "wives and elders died.\n"
      "   We were sick, tired, grieving, and one shade away from death.  Several times, "
      "we spoke of surrender, and we would have, too, if we weren't so absolutely certain "
      "that they would have killed us all.\n"
      "\n"
      ""
      "Chapter 3: Konima's Return\n"
      "\n"
      "   On the third night of the seventh week, in the middle of the night, an explosion, "
      "followed by an earthquake rocked the town of Tos.  I sat up, certain it was the "
      "orc's final offensive, somewhat thankful that the end was finally here, when a "
      "child ran up to where we were sleeping, and shouted, \"It's him! It's him!\"\n"
      "\n"
      "   And so it was.\n"
      "\n"
      "   From the city walls, we watched, as our saviors, a band of no more than twenty "
      "men, took on the orcish army who had been taken mostly by surprise.  And our "
      "saviors brought with them the sword of vengeance, the magics of the Gods, and an "
      "unrestrained fierceness.  Bursts of flame leapt across the sky, leaving ashes where "
      "whole squads of orcish armies had once been.  The sun mysteriously shone at the "
      "pitch of night, and the orcs seemed to wither before its purity.  The earth opened "
      "up, and swallowed the tent of the orcish leaders whole.\n"
      "\n"
      "   But the most incredible thing on the field was him.  Him!\n"
      "\n"
      ""
      "   I had never met Konima.  I was a mere lad when he had left his homeland of Tos "
      "on his great pilgrimage, and yet, there was still no doubting that this was Konima.  "
      "He waded through the orcish hordes, standing a head above the tallest of them, an "
      "ebon blade in each hand that seemed to strike effortlessly through anything that "
      "stood in their way.  He was magnificent.\n"
      "   And we, those of us in Tos, were inspired.  So inspired that we, starving, "
      "thirsting, weary, sick and hopeless, somehow found the strength to pick up our "
      "swords and rush outside and press the attack from another flank.  In retrospect, "
      "it was a horribly foolhardy thing to do, seeing as is Konima had the task well in "
      "hand, but at this point the orcs were in full retreat.  Furthermore, the main "
      "force had retreated to the south, leaving an auxiliary force to the north - we "
      "could take them from behind, and we could once again get fresh supplies through "
      "the badlands from the rest of the world.  Tos was saved.\n"
      "   We cheered, we clapped each other's heads, and we embraced our saviors, each "
      "other, even the trees, and the green foliage of which we thought we'd never seen "
      "again.  But Konima wasn't smiling, on this, the day of his greatest victory.\n"
      "   He raised his hand, and we all were quiet.  And then he spoke.  He said, "
      "\"Those orcs didn't just appear.  They had to come from someplace.  We have to "
      "find out where.\"\n"
      ""
      "Chapter 4: Sacrifice\n"
      "\n"
      "   The next night, Konima took back the northern pass.  He didn't kill them all, "
      "though.  He let them escape to the south, and then he followed them.  We watched "
      "him go by as we buried the dead on the battlefield.  I didn't expect to see him "
      "again, not for months, perhaps ever.  But he came back the next night.  He got all "
      "of us from Tos together in the Town Square, and he said, \"I want you to bury me "
      "alive.\"\n"
      "   He led us to where the orcs had led him - to a cave on the eastern rim of the "   
      "Twisted Wood, where I had played often as a child.  He said, \"There is a gate in "
      "there - a doorway into the depths that was somehow opened.  We must close it.\"  He "
      "paused, and then he said, \"but first, I must go in.\"\n"
      "   He was certain that the brunt of the orcish army was within, and that it was "
      "now reinforcing itself.  \"We can close the gate, but then they will merely open "
      "it again.  My comrades and I must strike in the heart of the orcish warrens.  You "
      "must seal the door, in case we fail.\"\n"
      "   I said, \"but we can't bury you alive!\"  He smiled, and said, \"Tos is my "
      "homeland, nothing is nearer to my heart.  If Tos falls, I am not truly alive "
      "anymore.\"  And then he threw me a wink, and said, \"besides, do you think a mere "
      "wall of rock can keep my sorcerers out?\"\n"
      "\n"
      ""
      "   And so he gathered the strongest men and women he had. Jeremiah of Cor Noth. "
      "Shal'ille's High Priestess Marianna. Raph Korsten. Melissa Ravenblade. Garron "
      "Damodred.  Even old man Froz himself stumbled into the darkness.  And, ever "
      "dutifully, a mage mystically closed and warded the gates behind them.  There was "
      "weeping, there were best wishes, there were fervent prayers to Shal'ille.\n"
      "   All of which must have gone unheard, because we never saw any of them again."

classvars:

   vrName = room_name_tosapoth

   viTeleport_row = 7
   viTeleport_col = 3

   viTerrain_type = TERRAIN_CITY | TERRAIN_SHOP

properties:

   viPermanent_flags = ROOM_NO_COMBAT

   prRoom = room_tosapoth
   piRoom_num = RID_TOS_APOTH

   piBaseLight = LIGHT_NICE
   piOutside_factor = 3

   prMusic = tosapoth_music

messages:


   CreateStandardExits()
   {
      plExits = $;

      %%TO TOWN
      plExits = Cons([ 6, 2, RID_TOS, 25, 22, ROTATE_NONE ],plExits);

      propagate;
   }

   CreateStandardObjects()
   {
      local oBook;

      Send(self,@NewHold,#what=Create(&OrnamentalObject,#type=OO_MORTARANDPESTLE),
           #new_row=5,#new_col=5,#fine_row=8,#fine_col=32,#new_angle=ANGLE_EAST);
      Send(self,@NewHold,#what=Create(&OrnamentalObject,#type=OO_FLASK_GREEN),
           #new_row=4,#new_col=5,#fine_row=40,#fine_col=32,#new_angle=ANGLE_EAST);
      Send(self,@NewHold,#what=Create(&OrnamentalObject,#type=OO_FLASK_GREEN),
           #new_row=6,#new_col=6,#fine_row=8,#fine_col=48,#new_angle=ANGLE_EAST);
      Send(self,@NewHold,#what=Create(&OrnamentalObject,#type=OO_FLASK_GREEN),
           #new_row=7,#new_col=6,#fine_row=0,#fine_col=48,#new_angle=ANGLE_EAST);
      Send(self,@NewHold,#what=Create(&OrnamentalObject,#type=OO_JUG),
           #new_row=2,#new_col=2,#fine_row=24,#fine_col=24,#new_angle=ANGLE_EAST);
      Send(self,@NewHold,#what=Create(&OrnamentalObject,#type=OO_FLASK_STAND),
           #new_row=6,#new_col=6,#fine_row=40,#fine_col=48,#new_angle=ANGLE_EAST);
      Send(self,@NewHold,#what=Create(&OrnamentalObject,#type=OO_NECBOTTLE),
           #new_row=6,#new_col=5,#fine_row=24,#fine_col=24,#new_angle=ANGLE_EAST);
      Send(self,@NewHold,#what=Create(&OrnamentalObject,#type=OO_GOOSE),
           #new_row=5,#new_col=6,#fine_row=16,#fine_col=48,#new_angle=ANGLE_EAST);
      Send(self,@NewHold,#what=Create(&OrnamentalObject,#type=OO_GOOSE),
           #new_row=5,#new_col=6,#fine_row=16,#fine_col=48,#new_angle=ANGLE_EAST);
      Send(self,@NewHold,#what=Create(&OrnamentalObject,#type=OO_FIXINS),
           #new_row=8,#new_col=6,#fine_row=0,#fine_col=48,#new_angle=ANGLE_EAST);
      Send(self,@NewHold,#what=Create(&OrnamentalObject,#type=OO_FIXINS),
           #new_row=8,#new_col=6,#fine_row=0,#fine_col=48,#new_angle=ANGLE_EAST);
      Send(self,@NewHold,#what=Create(&OrnamentalObject,#type=OO_GOLD_BOTTLE),
           #new_row=3,#new_col=5,#fine_row=40,#fine_col=32,#new_angle=ANGLE_EAST);

      % apothecary
      Send(self,@NewHold,#what=Create(&TosApothecary),
           #new_row=4,#new_col=6,#fine_row=10,#new_angle=ANGLE_SOUTH_WEST);

      oBook = Create(&BookPedestal,#Name=tosapoth_book_name,#Text=tosapoth_book_text);

      Send(self,@NewHold,#what=oBook,
           #new_row=2,#new_col=2,#fine_row=32,#fine_col=32,#new_angle=ANGLE_SOUTH_EAST);

      % Lighting
      send(self,@NewHold,#what=Create(&DynamicLight,#iColor=LIGHT_FIRE,#iIntensity=25),
           #new_row=8,#new_col=4,#fine_row=16,#fine_col=32);
      send(self,@NewHold,#what=Create(&DynamicLight,#iColor=LIGHT_FIRE,#iIntensity=25),
           #new_row=5,#new_col=3,#fine_row=64,#fine_col=32);
      send(self,@NewHold,#what=Create(&DynamicLight,#iColor=LIGHT_FIRE,#iIntensity=25),
           #new_row=2,#new_col=4,#fine_row=16,#fine_col=32);

      propagate;
   }


end
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
