% Meridian 59, Copyright 1994-2012 Andrew Kirmse and Chris Kirmse.
% All rights reserved.
%
% This software is distributed under a license that is described in
% the LICENSE file that accompanies it.
%
% Meridian is a registered trademark.


%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
BreakRodBlind is Rod

constants:

   include blakston.khd

resources:

   include breakrodblind.lkod

   BreakRodBlind_name_rsc = "rod of sight"
   BreakRodBlind_icon_rsc = wand5.bgf
   BreakRodBlind_desc_rsc = \
      "This rod is elegantly carved with sparkling runes. It exudes "
      "an implicit understanding that it will protect its bearer from "
      "blinding and dazzling magics for five seconds. The energies involved "
      "will also prevent the bearer from casting those same magics for ten "
      "seconds."
      
   BreakRodBlind_success_rsc = \
      "The rod sends flowing energies coursing through you!"
   
   BreakRodBlind_drop_rsc = \
      "The illuminating magics generated by your rod of sight fade."
   BreakRodBlind_secondary_drop_msg = \
      "You feel your ability to cast blinding magics return."
   BreakRodBlind_success_wav = kraanan.wav

classvars:

   vrName = BreakRodBlind_name_rsc
   vrIcon = BreakRodBlind_icon_rsc

   viBulk = 25
   viWeight = 25
   viValue_average = 800

   viGround_group = 2
   viInventory_group = 1
   
   vrGoodDesc = BreakRodBlind_desc_rsc
   
   use_success_msg = BreakRodBlind_success_rsc
   rod_success_wav_default_rsc = BreakRodBlind_success_wav
   duration_expire_msg = BreakRodBlind_drop_rsc
   secondary_duration_expire_msg = BreakRodBlind_secondary_drop_msg
   
   viStartHits = 3
   viStartMaxHits = 3
   viConsumesHits = 3

   vbDurationEffect = TRUE
   viEffectDuration = 5000
   vbSecondaryDurationEffect = TRUE
   viSecondaryEffectDuration = 10000

properties:
   
messages:

   CastSpell(what = $, apply_on = $)
   {
      % Dispel current blind so that immunity isn't wasted.
      if poOwner <> $
         AND IsClass(poOwner,&Player)
         AND Send(poOwner,@IsEnchanted,#byClass=&Blind)
      {
         Send(poOwner,@RemoveEnchantment,
               #what=Send(SYS,@FindSpellByNum,#num=SID_BLIND));
      }

      % Dispel current dazzle so that immunity isn't wasted.
      if poOwner <> $
         AND IsClass(poOwner,&Player)
         AND Send(poOwner,@IsEnchanted,#byClass=&Dazzle)
      {
         Send(poOwner,@RemoveEnchantment,
               #what=Send(SYS,@FindSpellByNum,#num=SID_DAZZLE));
      }

      propagate;
   }

end
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
